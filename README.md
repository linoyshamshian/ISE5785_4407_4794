# הפקת קואורדינטות וצבעים מתמונה משולשת

רצינו לאתגר את עצמנו, ובחרנו לנסות להפיק קואורדינטות של משולשים וצבעים מתוך תמונה שמורכבת מראש ממשולשים.  
המטרה הייתה לקבל עבור כל משולש בתמונה את שלושת הקודקודים שלו ואת הצבע שמייצג אותו, כדי שנוכל לבנות סצנה המכילה משולשים בלבד.

לשם כך השתמשנו בקוד פייתון שמשלב מספר אלגוריתמים קלאסיים מעולם עיבוד התמונה (OpenCV):

---

## תהליך העבודה והאלגוריתמים

1. **טעינת התמונה והמרה לגווני אפור**  
   - טוענים את קובץ התמונה וממירים אותו לגווני אפור, כהכנה לזיהוי קצוות ופינות.

2. **זיהוי נקודות מפתח (Vertices Detection)**
   - **Canny Edge Detection** – מזהה את כל הקצוות החזקים בתמונה (גבולות בין משולשים).
   - **Contour Detection & Douglas-Peucker Approximation** – מאתרים קווי מתאר (קונטורים) מתוך הקצוות, ומפשטים אותם לנקודות עיקריות בעזרת האלגוריתם של Douglas-Peucker (`approxPolyDP`).
   - **Shi-Tomasi Corner Detection** – מזהים פינות חזקות (כמו קודקודי משולשים) באמצעות `goodFeaturesToTrack`.
   - **הוספת נקודות קבועות** – מוסיפים ידנית את פינות התמונה והאמצעים, כדי להבטיח שכל האזור ייכלל.

3. **סינון נקודות צפופות**  
   - מסננים נקודות קרובות מדי זו לזו (לפי מרחק מינימלי), כדי להימנע ממשולשים קטנים או כפולים.

4. **טריאנגולציה דלוניי (Delaunay Triangulation)**  
   - מבצעים טריאנגולציה (פירוק למשולשים) על כל הנקודות שנבחרו, כך שנקבל רשת של משולשים שמכסה את כל התמונה.  
   - אלגוריתם דלוניי מבטיח שהמשולשים יהיו "טבעיים" (ללא זוויות חדות מדי), ויתאימו לגבולות האמיתיים של המשולשים בתמונה[3][4][1].

5. **חישוב צבע ממוצע לכל משולש**  
   - עבור כל משולש שנוצר:
     - יוצרים מסיכה שמכסה רק את האזור של המשולש.
     - מחשבים את הממוצע של ערכי ה-BGR (כחול, ירוק, אדום) של הפיקסלים שבמשולש.
     - שומרים את הקואורדינטות של שלושת הקודקודים (בפורמט תלת-ממדי) ואת הצבע הממוצע.

6. **שמירת נתונים והצגת תוצאות**
   - כל נתוני המשולשים (קודקודים וצבעים) נשמרים לקובץ JSON ולטקסט שטוח.
   - מציגים את התמונה המקורית, את הקצוות, את רשת המשולשים, ואת התמונה המשולשת הממולאת בצבעים הממוצעים.

---

## קבצי פלט

- `triangles_data.json` – לכל משולש נשמרים שלושת הקודקודים (x, y, z) והצבע הממוצע (RGB).
- `triangles_data.txt` – כל שורה מכילה את כל הערכים של משולש בפורמט שטוח:  
  `x1,y1,z1,x2,y2,z2,x3,y3,z3,R,G,B`

---

## דוגמה לזרימת עבודה

1. **קלט:**  
   ![Original Image](./example_input.jpg)

2. **גילוי קצוות ופינות:**  
   - קבלת סט של נקודות מפתח (קצוות + פינות + נקודות קבועות).

3. **טריאנגולציה:**  
   - פירוק התמונה לרשת משולשים בעזרת Delaunay.

4. **צביעת המשולשים:**  
   - כל משולש נצבע בצבע הממוצע של האזור שלו.

5. **פלט:**  
   ![Triangulated Output](./example_output.jpg)

---

## האלגוריתמים המרכזיים

- **Canny Edge Detector** – זיהוי קצוות.
- **Douglas-Peucker Algorithm** – פישוט קווי מתאר.
- **Shi-Tomasi Corner Detector** – זיהוי פינות.
- **Delaunay Triangulation** – פירוק הנקודות למשולשים.
- **Color Averaging** – חישוב צבע ממוצע לכל אזור.

---

## איך להריץ

1. שימו את קובץ התמונה בתיקיית הפרויקט ועדכנו את שם הקובץ בקוד (`image_path`).
2. הריצו את הסקריפט עם פייתון וספריית OpenCV מותקנת.
3. התוצאות (קבצי נתונים ותמונות) יישמרו באותה תיקייה.

---

## קרדיטים

הפרויקט נבנה בעזרת Python ו-OpenCV, תוך שימוש באלגוריתמים קלאסיים מעולם ראיית המחשב.

לשאלות, הערות או שיפורים – מוזמנים לפתוח Issue או Pull Request ב-GitHub.

